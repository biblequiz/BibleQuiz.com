---
import { getReleaseData } from '../utils/AppReleases';

interface Props {
  product: string;
}

const { product } = Astro.props;
const releaseData = getReleaseData(product);

if (!releaseData) {
  return null;
}

const { analysis } = releaseData;
---

<div class="release-summary">
  <h2>{product} Releases</h2>
  
  <div class="stats">
    <div class="stat">
      <span class="label">Total Releases:</span>
      <span class="value">{analysis.totalReleases}</span>
    </div>
    
    <div class="stat">
      <span class="label">Stable:</span>
      <span class="value">{analysis.stableReleaseCount}</span>
    </div>
    
    <div class="stat">
      <span class="label">Pre-release:</span>
      <span class="value">{analysis.prereleaseCount}</span>
    </div>
    
    <div class="stat">
      <span class="label">Total Downloads:</span>
      <span class="value">{analysis.totalDownloads}</span>
    </div>
  </div>

  {analysis.latestRelease && (
    <div class="latest-release">
      <h3>Latest Release</h3>
      <p>
        <strong>{analysis.latestRelease.name}</strong>
        <span class="tag">{analysis.latestRelease.tag_name}</span>
        {analysis.latestRelease.prerelease && <span class="badge prerelease">Pre-release</span>}
      </p>
      <p class="date">
        Published: {new Date(analysis.latestRelease.published_at).toLocaleDateString()}
      </p>
      <a href={analysis.latestRelease.html_url} target="_blank" rel="noopener noreferrer">
        View on GitHub →
      </a>
    </div>
  )}

  {analysis.latestStableRelease && analysis.latestStableRelease !== analysis.latestRelease && (
    <div class="stable-release">
      <h3>Latest Stable Release</h3>
      <p>
        <strong>{analysis.latestStableRelease.name}</strong>
        <span class="tag">{analysis.latestStableRelease.tag_name}</span>
      </p>
      <p class="date">
        Published: {new Date(analysis.latestStableRelease.published_at).toLocaleDateString()}
      </p>
      <a href={analysis.latestStableRelease.html_url} target="_blank" rel="noopener noreferrer">
        View on GitHub →
      </a>
    </div>
  )}

  <div class="actions">
    <a href={`/api/releases/${product}.json`} download class="button">
      Download Release Data (JSON)
    </a>
  </div>
</div>

<style>
  .release-summary {
    padding: 1.5rem;
    border: 1px solid #e5e7eb;
    border-radius: 0.5rem;
    background: white;
  }

  h2 {
    margin-top: 0;
    margin-bottom: 1rem;
  }

  h3 {
    margin-top: 1.5rem;
    margin-bottom: 0.5rem;
    font-size: 1.125rem;
  }

  .stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .stat {
    display: flex;
    flex-direction: column;
    padding: 0.75rem;
    background: #f9fafb;
    border-radius: 0.375rem;
  }

  .stat .label {
    font-size: 0.875rem;
    color: #6b7280;
    margin-bottom: 0.25rem;
  }

  .stat .value {
    font-size: 1.5rem;
    font-weight: 600;
    color: #111827;
  }

  .latest-release,
  .stable-release {
    padding: 1rem;
    background: #f9fafb;
    border-radius: 0.375rem;
    margin-bottom: 1rem;
  }

  .tag {
    font-family: monospace;
    background: #e5e7eb;
    padding: 0.125rem 0.5rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
    margin-left: 0.5rem;
  }

  .badge {
    display: inline-block;
    padding: 0.125rem 0.5rem;
    border-radius: 0.25rem;
    font-size: 0.75rem;
    font-weight: 600;
    margin-left: 0.5rem;
  }

  .badge.prerelease {
    background: #fef3c7;
    color: #92400e;
  }

  .date {
    font-size: 0.875rem;
    color: #6b7280;
    margin: 0.5rem 0;
  }

  a {
    color: #2563eb;
    text-decoration: none;
  }

  a:hover {
    text-decoration: underline;
  }

  .actions {
    margin-top: 1.5rem;
    padding-top: 1.5rem;
    border-top: 1px solid #e5e7eb;
  }

  .button {
    display: inline-block;
    padding: 0.5rem 1rem;
    background: #2563eb;
    color: white;
    border-radius: 0.375rem;
    text-decoration: none;
    font-weight: 500;
  }

  .button:hover {
    background: #1d4ed8;
    text-decoration: none;
  }
</style>
